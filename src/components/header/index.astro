---
import Logo from '../logo/index.astro'
import { generate_rel_link } from '~/utils/links'
const {title, category} = Astro.props;
---

<div class="header">
    <div class:list={['top',
      (import.meta.env.PROD ? Astro.url.pathname === import.meta.env.BASE_URL : Astro.url.pathname === '/') ? 'is-homepage' : '']}>
        <div class="container xxl">
            <header class="navbar">
                <div style="display: inline-flex;gap: 15px;">
                    <ul class="nav horizontal">
                        <li class="item">
                            <Logo class="link"/>
                        </li>
                    </ul>
                    <ul class="nav menu">
                        <li class="item">
                            <a href={generate_rel_link(Astro,
                              './docs/1.0/en/getting-started/introduction')}
                               class="link"
                               target="_self" aria-label="Components">
                                Components
                            </a>
                        </li>
                        <li class="item">
                            <a href={generate_rel_link(Astro,
                              './sections/1.0/en/welcome')} class="link"
                               target="_self"
                               aria-label="Sections">
                                Sections
                            </a>
                        </li>
                    </ul>
                </div>
                <div>
                    <ul class="nav horizonatal menu">
                        <li class="item">
                            <a
                                    href="https://github.com/nulllogic/xiigrid"
                                    class="link"
                                    target="_blank"
                            >
                                <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="20"
                                        height="20"
                                        role="img"
                                        viewBox="0 0 16 16"
                                >
                                    <title>GitHub</title>
                                    <path
                                            fill="currentColor"
                                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
                                    ></path>
                                </svg>
                            </a>
                        </li>
                        <li class="item">
                            <a
                                    href="https://github.com/nulllogic/xiigrid"
                                    class="link toggle dark_mode"
                                    target="_blank"
                                    aria-label="Toggle light/dark mode"
                                    title="Toggle light/dark mode"
                            >
                                <svg class="white" width="22px" fill="none"
                                     viewBox="0 0 24 24" stroke-width="1.5"
                                     stroke="currentColor">
                                    <path stroke-linecap="round"
                                          stroke-linejoin="round"
                                          d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path>
                                </svg>
                                <svg class="dark" width="22px"
                                     viewBox="0 0 18.8 18.9">
                                    <path stroke-linejoin="round"
                                          d="M5.4,5.6c0,4.1,3.4,7.5,7.5,7.5s2-.2,2.9-.6c-1.1,2.7-3.8,4.6-6.9,4.6S1.4,13.8,1.4,9.6,3.3,3.9,6,2.7c-.4.9-.6,1.9-.6,2.9Z"/>
                                    <path stroke-linejoin="round"
                                          d="M11.2,2.1v-1c.1,0,.3,1,.3,1,0,.4.4.8.8.8h1c0,.1-1,.3-1,.3-.4,0-.8.4-.8.8v1c-.1,0-.3-1-.3-1,0-.4-.4-.8-.8-.8h-1c0-.1,1-.3,1-.3.4,0,.8-.4.8-.8Z"/>
                                    <path stroke-linejoin="round"
                                          d="M15.2,7.1v-1c.1,0,.3,1,.3,1,0,.4.4.8.8.8h1c0,.1-1,.3-1,.3-.4,0-.8.4-.8.8v1c-.1,0-.3-1-.3-1,0-.4-.4-.8-.8-.8h-1c0-.1,1-.3,1-.3.4,0,.8-.4.8-.8Z"/>
                                </svg>
                            </a>
                        </li>
                        <li class="item">
                            <a href="#" class="link toggle mainmenu">
                                <svg viewBox="0 0 24 24" fill="none"
                                     stroke="currentColor" stroke-width="1.5"
                                     data-slot="icon" aria-hidden="true"
                                     width="24px">
                                    <path d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
                                          stroke-linecap="round"
                                          stroke-linejoin="round"></path>
                                </svg>
                            </a>
                        </li>
                    </ul>
                </div>
            </header>
        </div>
    </div>
  {(import.meta.env.PROD ? Astro.url.pathname !== import.meta.env.BASE_URL : Astro.url.pathname !== '/') && (
          <div class="bottom">
              <div class="container">
                  <nav aria-label="breadcrumb">
                      <ul class="breadcrumb">
                          <li class="item">
                              <a href="#"
                                 class="btn blank link toggle sidemenu">
                                  <svg viewBox="0 0 16 16" fill="currentColor"
                                       width="14px">
                                      <path fill-rule="evenodd"
                                            d="M2 4.75A.75.75 0 0 1 2.75 4h10.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 4.75Zm0 6.5a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H2.75a.75.75 0 0 1-.75-.75Z"
                                            clip-rule="evenodd"></path>
                                  </svg>
                              </a>
                          </li>
                          <li class="item" aria-current="page"
                              style="margin-left: .75rem;">{category ? category : ''}
                          </li>
                          <li class="item">
                              <svg width="17" height="17"
                                   xmlns="http://www.w3.org/2000/svg"
                                   viewBox="0 0 16 16"
                                   fill="currentColor"
                                   aria-hidden="true">
                                  <path fill-rule="evenodd"
                                        d="M6.22 4.22a.75.75 0 0 1 1.06 0l3.25 3.25a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 0 1-1.06-1.06L8.94 8 6.22 5.28a.75.75 0 0 1 0-1.06Z"
                                        clip-rule="evenodd"/>
                              </svg>
                          </li>
                          <li class="item active" aria-current="page">{title ? title.split('|')[0].trim() : ''}
                          </li>
                      </ul>
                  </nav>
              </div>
          </div>
  )}
</div>

<style lang="scss">

  @use 'sass:list';
  @use 'sass:string';
  @use 'sass:meta';
  @use 'sass:map';

  @use '~/styles/app.scss' as app;


  $mobile_menu_button: (
    display: inherit,
    _responsive: (
      lg : (
        display: none,
      )
    )
  );

  $scheme_color_switcher: (
    width: 22px,
    height: 22px,
    position: relative,
    _animations : (
      'icon-enter' : (
        '0%' : (
          opacity: 0,
          transform:rotate(180deg)
        ),
        '100%' : (
          opacity: 1,
          transform:rotate(0deg)
        )
      ),
    ),
    _subclasses: (
      '&:hover' : (
        transform: scale(1.15),
      ),
      '&.clicked' : (
        _subclasses: (
          '.white' : (
            opacity: 0,
            animation: icon-enter 0.2s forwards,
          ),
          '.dark' : (
            opacity: 0,
            animation: icon-enter 0.2s forwards,
          )
        )
      ),
      'svg' : (
        transform: rotate(0),
        opacity: 1,
        position: absolute,
        transition: string.unquote('transform 0.15s ease-in, opacity 0.2s ease-in'),
      ),
      '.white' : (
        display: var(--icon-display),
        _colors: (
          light : (
            icon-display: none,
          ),
          dark : (
            icon-display: inline-block
          )
        )
      ),
      '.dark' : (
        display: var(--icon-display),
        _colors: (
          light : (
            icon-display: inline-block
          ),
          dark : (
            icon-display: none,
          )
        )
      ),
    )
  );

  $navbar: (
    --navbar-grid-template-columns: auto auto,
    _subclasses : (
      ':nth-child(1)' : (
        _subclasses : (
          '.nav' : (
            --nav-gap : 15px,
            _subclasses : (
              '&.menu' : (
                display: none,
                _responsive: (
                  lg : (
                    display: inherit,
                  )
                )
              )
            )
          )
        )
      ),
      ':nth-child(2)' : (
        justify-self: end,
        _subclasses : (
          '.nav' : (
            --nav-gap : .825rem,
            _subclasses : (
              '&.menu' : (
                _subclasses : (
                  '.item' : (
                    display: none,
                    _responsive: (
                      lg : (
                        display: inherit,
                      )
                    )
                  ),
                  '.item:last-child' : (
                    display: inherit,
                    _responsive: (
                      lg : (
                        display: none,
                      )
                    )
                  )
                )
              )
            )
          )
        )
      )
    )
  );

  $header-section: (
    background: var(--background),
    top: 0,
    position: relative,
    z-index: app.get-config(app.$config, 'z-index.header'),
    /***/
    _colors: (
      light : (
        background : string.unquote('linear-gradient(rgba(216, 216, 216, 0.79), rgba(55, 241, 14, 0.09))'),
        border : 1px solid rgba(232, 244, 229, 1),
        shadow: 0 1px 2px #00000026,
      ),
      dark : (
        background : string.unquote('linear-gradient(rgba(10, 34, 8, 0.85) 0%, rgba(28, 43, 31, 0.55) 100%)'),
        border : 1px solid rgba(27, 60, 24, 1),
        shadow : 0 1px 2px #00000026,
      )
    ),
    /***/
    _subclasses : (
      '.top': (
        border-bottom: var(--border),
        box-shadow: none,
        /***/
        padding-inline: var(global(--padding-inline)),
        padding-block: 7px,
        /***/
        _responsive : (
          lg: (
            margin: 0,
            box-shadow: var(--shadow),
          )
        ),
        /***/
        _subclasses : (
          '&.is-homepage' : (
            box-shadow: var(--shadow),
          ),
          '.navbar' : $navbar,
          '.link.toggle.dark_mode' : $scheme_color_switcher,
          '.link.toggle.mobile_menu' : $mobile_menu_button,
        )
      ),
      '.bottom': (
        display: block,
        border-bottom: var(--border),
        /***/
        padding-inline: var(global(--padding-inline)),
        padding-block: 10px 10px,
        box-shadow: var(--shadow),
        /***/
        _responsive : (
          lg: (
            display: none,
            box-shadow: none,
          )
        )
      ),
      '&.sticky' : (
        position: sticky,
        -webkit-backdrop-filter: blur(10px),
        backdrop-filter: blur(10px),
      ),
    ),
  );

  @include app.generate-component(
      $header-section,
      'header',
      app.$config,
      app.$theme,
      (variable: (exclude : ('nav', 'navbar')))
  );
</style>

<script type="text/javascript">
  const nav = document.querySelector('.header');
  const navTop = nav.offsetTop;

  function stickyNavigation () {
    if (window.scrollY > navTop) {
      nav.classList.add('sticky')
    } else {
      nav.classList.remove('sticky')
    }
  }

  window.addEventListener('scroll', stickyNavigation);
</script>

<script>

  const light_dark_toggler = document.querySelector('.toggle.dark_mode');

  if (light_dark_toggler) {
    light_dark_toggler.addEventListener('click', (e) => {
      e.preventDefault();

      light_dark_toggler.classList.add('clicked');

      const current_theme = document.documentElement.getAttribute('data-theme')
      const new_theme = current_theme === 'dark' ? 'light' : 'dark'
      document.documentElement.setAttribute('data-theme', new_theme)

      document.body.classList.add('preload');
      localStorage.setItem('theme', new_theme)
      setTimeout(() => {
        document.body.classList.remove('preload');
      }, 200)
      const event = new CustomEvent('theme_change', {
        detail: {
          theme: new_theme,
        },
      })
      document.dispatchEvent(event);
    })
  }

  const nav = document.querySelector('.header');
  const buttons = nav.querySelectorAll('.link.toggle');

  buttons.forEach(button => button.addEventListener('click', (e) => {
    e.preventDefault();

    if (button.classList.contains('sidemenu')) {
      document.getElementById('sidebar_mobile_menu').classList.toggle('show');
      document.body.toggleAttribute('scroll-lock');
    }

    if (button.classList.contains('mainmenu')) {
      document.getElementById('main_mobile_menu').classList.toggle('show');
      document.body.toggleAttribute('scroll-lock');
    }
  }))

</script>

